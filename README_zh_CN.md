# MDD (åº¦é‡é©±åŠ¨å¼€å‘)

ç®€ä½“ä¸­æ–‡ | [English](REAME.md)

ä½œè€…: Walter Fan [ðŸ¤µ](https://www.fanyamin.com)

[![Twitter Follow](https://img.shields.io/twitter/follow/walterfan?style=social)](https://twitter.com/walterfan)


## æ¦‚è§ˆ
### ä¸ºä»€ä¹ˆé€‰æ‹©MDD

* å¦‚æžœä½ æ— æ³•åº¦é‡å®ƒï¼Œä½ å°±æ— æ³•ç®¡ç†å®ƒã€‚
* å¦‚æžœä½ æ— æ³•åº¦é‡å®ƒï¼Œä½ å°±æ— æ³•è¯æ˜Žå®ƒã€‚
* å¦‚æžœä½ æ— æ³•åº¦é‡å®ƒï¼Œä½ å°±æ— æ³•æ”¹è¿›å®ƒã€‚

### ä»€ä¹ˆæ˜¯MDD

ä¸€ç§é€šè¿‡åº¦é‡æ¥æŽ¨åŠ¨å¼€å‘ï¼Œä»¥ä¸æ–­æ”¹è¿›è½¯ä»¶äº§å“å’ŒæœåŠ¡çš„å¼€å‘æ–¹æ³•ï¼š

* åŸºäºŽåº¦é‡æ¥éªŒè¯ç›®æ ‡çš„è¾¾æˆã€‚
* åŸºäºŽåº¦é‡æ¥ä¼˜åŒ–å’Œæå‡ç³»ç»Ÿã€‚
* åŸºäºŽåº¦é‡æ¥åšå†³ç­–ã€‚

### åº¦é‡å†…å®¹

ç¼©å†™ **USED**

- **Usageï¼ˆä½¿ç”¨é‡ï¼‰:** è¡¡é‡ç”¨æˆ·ä¸Žç³»ç»Ÿäº¤äº’çš„é¢‘çŽ‡åŠæ–¹å¼ï¼Œåæ˜ åŠŸèƒ½å‚ä¸Žåº¦å’Œæ´»åŠ¨æ°´å¹³ã€‚
- **Saturationï¼ˆé¥±å’Œåº¦ï¼‰:** åæ˜ ç³»ç»ŸæŽ¥è¿‘æœ€å¤§å®¹é‡çš„ç¨‹åº¦ï¼Œå¦‚CPUã€å†…å­˜æˆ–ç½‘ç»œçš„ä½¿ç”¨æƒ…å†µã€‚
- **Errorï¼ˆé”™è¯¯çŽ‡ï¼‰:** è¿½è¸ªç³»ç»Ÿä¸­æ•…éšœæˆ–é—®é¢˜çš„å‘ç”Ÿï¼Œæä¾›å…³äºŽç³»ç»Ÿç¨³å®šæ€§å’Œå¯é æ€§çš„è§è§£ã€‚
- **Delayï¼ˆå»¶è¿Ÿï¼‰:** è¡¡é‡ç³»ç»Ÿå“åº”è¯·æ±‚çš„æ—¶é—´ï¼Œåæ˜ ç³»ç»Ÿçš„æ€§èƒ½å’Œå“åº”é€Ÿåº¦ã€‚

### åº¦é‡ç±»åž‹

* Gaugeï¼ˆä»ªè¡¨ï¼‰: æŸä¸ªæ—¶åˆ»çš„çž¬æ—¶å€¼ã€‚
* Counterï¼ˆè®¡æ•°å™¨ï¼‰: é€’å¢žå’Œé€’å‡çš„å€¼ã€‚
* Meterï¼ˆè®¡é‡å™¨ï¼‰: ä¸€æ®µæ—¶é—´å†…äº‹ä»¶çš„å¹³å‡å‘ç”ŸçŽ‡ã€‚
* Histogramï¼ˆç›´æ–¹å›¾ï¼‰: æ•°æ®æµä¸­æ•°å€¼çš„ç»Ÿè®¡åˆ†å¸ƒã€‚
* Timerï¼ˆè®¡æ—¶å™¨ï¼‰: æŒç»­æ—¶é—´çš„ç›´æ–¹å›¾å’Œè°ƒç”¨æ¬¡æ•°çš„è®¡é‡å™¨ã€‚

## MDD æ•™ç¨‹
* [Collected çš„ç”¨æ³•](oss/collectd/README.md)
* [ELKK çš„ç”¨æ³•](oss/elkk/readme.md) - ElasticSearch, LogStash, Kibana, Kafka
* [TIGK çš„ç”¨æ³•](oss/tig/v2/README.md) - Telegraf, InfluxDB, Grafana, Kafka
* [Hadoop çš„ç”¨æ³•](oss/hadoop/readme.md)
* [Prometheus çš„ç”¨æ³•](oss/prometheus/README.md)
* [å¦‚ä½•æ¨¡æ‹Ÿå¼±ç½‘æ¡ä»¶ - é™æµ, ä¸¢åŒ…, å»¶è¿Ÿå’ŒæŠ–åŠ¨](https://www.jianshu.com/p/ce04bf2f9db6)
* [åˆ†æžç½‘ç»œæŠ“åŒ…ç”¨ python æ›´é«˜æ•ˆ](https://www.jianshu.com/p/1a616442aaca)
* [WebRTC ä¹‹åº¦é‡ä¸Žç»Ÿè®¡: åˆ°åº•å‡ºäº†ä»€ä¹ˆé—®é¢˜](https://www.jianshu.com/p/419ca6fbdb60)
* [WebRTC å†…éƒ¨åº¦é‡æ–‡ä»¶çš„åˆ†æž](https://www.jianshu.com/p/efb933d55bba)
* [C++ç¨‹åºåº¦é‡é©±åŠ¨è°ƒä¼˜å®žä¾‹ï¼šçœ‹ç‹„æ›´æ–¯çš„åŒåŸŽè®°ï¼Œå¯»æ‰¾æ€§èƒ½ç“¶é¢ˆ](https://www.jianshu.com/p/a2988a17d146)
* [å¾®æœåŠ¡ç¼“å­˜çš„ä½¿ç”¨åº¦é‡](https://www.jianshu.com/p/35023210e637)
* [Redis é›†ç¾¤çš„æž„å»ºå’Œç›‘æŽ§](https://www.jianshu.com/p/ced0a95cbc21)
* [JVM å‚æ•°æ€Žä¹ˆè°ƒ](https://www.jianshu.com/p/20fb5ccffd9f)
* [ä½¿ç”¨ Redis è®°å½•å¾®æœåŠ¡çš„åº”ç”¨ç¨‹åºæ€§èƒ½æŒ‡æ•° APDEX](https://www.jianshu.com/p/684689942905)
* [çº¿ç¨‹æ± çš„ç›‘æŽ§ä¸Žä¼˜åŒ–](https://www.jianshu.com/p/6b71221792fb)
* [å†…å­˜æº¢å‡ºä¸å¯æ€•ï¼Œæ‰‹è¶³æ— æŽªæ‰å°´å°¬](https://www.jianshu.com/p/12d00ca68cda)
* [å¾®æœåŠ¡æ—¥å¿—åˆ†æžä¹‹ELKK](https://www.jianshu.com/p/d391c63adcaa)
* [ç³»ç»ŸæŒ‡æ ‡ç›‘æŽ§ collectd + influxDB + grafana](https://www.jianshu.com/p/e8c232228986)

## MDD ä¹¦ç±

ã€Šå¾®æœåŠ¡ä¹‹é“: åº¦é‡é©±åŠ¨å¼€å‘ã€‹
 -- Walter Fan, Jian Fu

å¦‚æžœåœ¨å®‰è£…å’Œæµ‹è¯•ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·åœ¨æ­¤ä»“åº“ä¸­æäº¤é—®é¢˜ï¼Œæˆ‘ä»¬å°†å°½å¿«å›žåº”å¹¶è§£å†³ã€‚

### æ¨¡å—

1. è´¦æˆ·æœåŠ¡

	åŸºäºŽ Python çš„ Flask è´¦æˆ·æœåŠ¡

2. å‘Šè­¦å™¨

	åŸºäºŽ ElasticSearch API ç›‘æµ‹åº¦é‡å¹¶è§¦å‘å‘Šè­¦ã€‚

3. Potato æœåŠ¡

	åŸºäºŽ Spring Boot çš„ Potato æœåŠ¡

   * Consul å¿«ç…§:
   
	![Consul Snapshot](snapshot/consul_snapshot.png)

   * ç½‘é¡µ:
   
	![Potato Service GUI](snapshot/potato_web_gui.png)

   * Web API:
   
	![Potato Service API](snapshot/potato_server_api.png)

4. è„šæœ¬

  * æ•°æ®åˆ†æžè„šæœ¬
  * æ€§èƒ½æµ‹è¯•è„šæœ¬
  
5. docker

	å¸¸ç”¨çš„ docker æ–‡ä»¶

6. oss

	ELKKã€TIG ç­‰å·¥å…·çš„å®‰è£…å’Œè®¾ç½®æŒ‡å—

7. devops

	å¼€å‘è¿ç»´ç›¸å…³è„šæœ¬

### çŽ¯å¢ƒè®¾ç½®

ä»¥ Ubuntu 16 ä¸ºä¾‹

```
apt install docker
apt install docker-compose
```

#### Python çŽ¯å¢ƒ

```
apt install python3
apt install python3-pip

pip3 install virtualenv

virtualenv -p python3 venv
source venv/bin/activate

pip install fabric3
```

#### Java çŽ¯å¢ƒ

```
apt install openjdk-8-jdk
apt install maven
```

### å¿«é€Ÿå¼€å§‹

è¯·ç¡®ä¿æ‰€æœ‰ä¾èµ–å·²å‡†å¤‡å¥½ã€‚ç„¶åŽä½ å¯ä»¥ä¾æ¬¡å¯åŠ¨å¹¶è°ƒè¯•æœåŠ¡ï¼Œä½¿ç”¨ Consul å’Œ InfluxDBã€‚

ç¡®ä¿ç›¸å…³ä¾èµ–å·²å®‰è£…ï¼Œå¹¶ä½¿ç”¨ docker-compose æ¥ç®¡ç†åº”ç”¨ç¨‹åºåŠå…¶ä¾èµ–é¡¹ã€‚å¦‚æžœä½ æƒ³æŒ‰æœåŠ¡é€ä¸ªè°ƒè¯•ï¼Œå¯ä»¥ä»Ž Consul å’Œ InfluxDB å¼€å§‹ã€‚

```
cd potato
docker-compose start consul influxdb
```

potato/fabfile.py æ–‡ä»¶åŒ…å«æž„å»ºå’Œéƒ¨ç½²æ­¥éª¤ï¼Œä½ å¯ä»¥é¦–å…ˆè¿è¡Œå®ƒï¼Œç„¶åŽé€æ­¥å°è¯•å„ä¸ªæ­¥éª¤ã€‚

### Potato æœåŠ¡ç¤ºä¾‹

#### ä¾èµ–

 * python3
 * fabric3
 * jdk8
 * maven3

#### éƒ¨ç½²

```
cd potato
fab redeploy
```

* æŸ¥çœ‹è¿è¡ŒçŠ¶æ€

```

docker-compose ps
                Name                                   Command                                  State                                   Ports
-------------------------------------------------------------------------------------------------------------------------------------------------------------
consul                                  docker-entrypoint.sh agent ...          Up                                      8300/tcp, 8301/tcp, 8301/udp,
                                                                                                                        8302/tcp, 8302/udp,
                                                                                                                        0.0.0.0:8400->8400/tcp,
                                                                                                                        0.0.0.0:8500->8500/tcp,
                                                                                                                        0.0.0.0:8600->8600/tcp,
                                                                                                                        0.0.0.0:8600->8600/udp
influxdb                                /entrypoint.sh influxd                  Up                                      0.0.0.0:8083->8083/tcp,
                                                                                                                        0.0.0.0:8086->8086/tcp
local-mysql                             docker-entrypoint.sh --ini ...          Up                                      0.0.0.0:3306->3306/tcp, 33060/tcp
potato-scheduler                        java -jar /opt/potato-sche ...          Up                                      0.0.0.0:9002->9002/tcp
potato-server                           java -jar /opt/potato-app.jar           Up                                      0.0.0.0:9003->9003/tcp
potato-web                              java -jar /opt/potato-web.jar           Up                                      0.0.0.0:9005->9005/tcp
potato-zipkin                           /busybox/sh run.sh                      Up                                      9410/tcp, 0.0.0.0:9411->9411/tcp
```


* æ‰“å¼€ Potato åº”ç”¨çš„ web é—¨æˆ·

```
open http://localhost:9005
```